input {
  udp {
    port  => 5000
    codec => json
  }
  tcp {
    port  => 5000
    codec => json
  }
}

filter {
  if [docker][image] =~ /tor/ {
    mutate {
      add_field => {
        "tari_service" => "tor"
      }
    }
  }

  if [docker][image] =~ /tari_base_node/ {
    mutate {
      add_field => {
        "tari_service" => "base_node"
      }
    }
  }

  # TODO rest of services
  # if [docker][image] =~ /tari_base_node/ {
    # mutate {
      # add_field => {
        # "tari_service" => "base_node"
      # }
    # }
  # }
}

filter {
  mutate {
    add_field => {
      "job" => "logstash"
    }
    replace => { "type" => "stream"}
  }
}

output {
  loki {
    url => "http://loki:3100/loki/api/v1/push"

    # [tenant_id => string | default = nil | required=false]

    # [message_field => string | default = "message" | required=false]

    # [include_fields => array | default = [] | required=false]

    # [batch_wait => number | default = 1(s) | required=false]

    # [batch_size => number | default = 102400(bytes) | required=false]

    # [min_delay => number | default = 1(s) | required=false]

    # [max_delay => number | default = 300(s) | required=false]

    # [retries => number | default = 10 | required=false]

    # [username => string | default = nil | required=false]

    # [password => secret | default = nil | required=false]

    # [cert => path | default = nil | required=false]

    # [key => path | default = nil| required=false]

    # [ca_cert => path | default = nil | required=false]

    # [insecure_skip_verify => boolean | default = false | required=false]
  }
}
